@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #app {
    height: 100%;
  }

  body {
    margin: 0;
    @apply bg-app-background text-parchment font-ui;
    position: relative;
    overflow-x: hidden;
  }

  /* Grain texture overlay */
  body::before {
    content: '';
    pointer-events: none;
    position: fixed;
    inset: 0;
    opacity: 0.38;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.4'/%3E%3C/svg%3E");
    mix-blend-mode: overlay;
    z-index: 9999;
  }

  /* Vignette overlay */
  body::after {
    content: '';
    pointer-events: none;
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at 50% 50%, transparent 50%, rgba(2, 2, 4, 0.7) 100%);
    z-index: 9998;
  }

  /* Custom scrollbar */
  * {
    scrollbar-width: thin;
    scrollbar-color: #3a2f1a #050507;
  }

  *::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  *::-webkit-scrollbar-track {
    background: #050507;
  }

  *::-webkit-scrollbar-thumb {
    background: #3a2f1a;
    border-radius: 999px;
  }

  *::-webkit-scrollbar-thumb:hover {
    background: #C8A84B;
  }

  /* Focus ring — barely perceptible gold */
  *:focus-visible {
    outline: 1px solid rgba(200, 168, 75, 0.5);
    outline-offset: 2px;
  }
}

@layer components {
  /* Glowing rune divider */
  .rune-divider {
    @apply relative flex items-center gap-3 my-4;
  }
  .rune-divider::before,
  .rune-divider::after {
    content: '';
    @apply flex-1 h-px bg-gradient-to-r from-transparent via-gold-dim to-transparent;
  }

  /* Drip border top — blood effect on selected cards */
  .blood-top {
    border-top: 2px solid #8B1111;
    box-shadow: 0 -2px 12px rgba(139, 17, 17, 0.5);
  }

  /* Mystical badge */
  .badge-rune {
    @apply inline-flex items-center gap-1 rounded-full border border-app-border bg-app-surface px-2.5 py-0.5 text-[10px] font-ui uppercase tracking-widest text-parchment-muted;
  }

  /* Input — forge-molded */
  .input-forge {
    @apply w-full rounded-lg border border-app-border bg-app-surface px-3 py-2.5 text-sm text-parchment placeholder:text-parchment-dim
           focus:border-gold focus:outline-none focus:ring-1 focus:ring-gold/30
           transition duration-200;
  }

  /* Button — primary summon */
  .btn-summon {
    @apply inline-flex items-center justify-center gap-2 rounded-lg border border-gold/60 bg-gold/10 px-5 py-2.5
           font-heading text-xs tracking-[0.25em] uppercase text-gold
           hover:bg-gold/20 hover:border-gold hover:shadow-gold-glow
           active:scale-[0.98]
           transition-all duration-200;
  }

  /* Button — ghost */
  .btn-ghost {
    @apply inline-flex items-center justify-center gap-2 rounded-lg border border-app-border bg-transparent px-5 py-2.5
           font-ui text-xs tracking-[0.15em] uppercase text-parchment-muted
           hover:border-parchment-muted hover:text-parchment
           active:scale-[0.98]
           transition-all duration-200;
  }

  /* Card shell */
  .card-shell {
    @apply rounded-xl border border-app-border bg-card-surface shadow-void-deep;
    background: linear-gradient(160deg, #0C0C12 0%, #050507 100%);
  }

  /* Page enter animation  */
  .page-rise {
    @apply animate-rise;
  }

  /* Section heading bar */
  .section-label {
    @apply text-[10px] font-ui font-medium uppercase tracking-[0.35em] text-parchment-muted;
  }

  /* Map popup override */
  .leaflet-popup-content-wrapper {
    background: #0C0C12 !important;
    border: 1px solid #1E1E2E !important;
    border-radius: 10px !important;
    box-shadow: 0 0 24px rgba(0,0,0,0.9), 0 0 8px rgba(200,168,75,0.1) !important;
    color: #D4CDB8 !important;
    padding: 0 !important;
  }

  .leaflet-popup-content {
    margin: 0 !important;
  }

  .leaflet-popup-tip {
    background: #1E1E2E !important;
  }

  .leaflet-popup-close-button {
    color: #5A5570 !important;
    top: 6px !important;
    right: 8px !important;
  }

  .leaflet-popup-close-button:hover {
    color: #C8A84B !important;
  }
}

/* ── Keyframes accessible to Leaflet DivIcon inline HTML ── */
@keyframes pin-pulse {
  0%, 100% { transform: scale(1); opacity: 0.55; }
  50% { transform: scale(1.35); opacity: 0.15; }
}

@keyframes flicker-body {
  0%, 100% { opacity: 1; }
  33% { opacity: 0.93; }
  66% { opacity: 0.97; }
  80% { opacity: 0.89; }
}
